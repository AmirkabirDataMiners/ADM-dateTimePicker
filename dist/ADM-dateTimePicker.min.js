/*
* Picking date & time in AngularJS is easier than ever.
* 
* Demo: http://amirkabirdataminers.github.io/ADM-dateTimePicker
*
* @version 1.2.0
*
* © 2017 Amirkabir Data Miners <info@adm-co.net> - www.adm-co.net
*/

!function(e){"use strict";e.merge||(e.merge=e.extend),String.prototype.toPersianDigits=function(){var e=["۰","۱","۲","۳","۴","۵","۶","۷","۸","۹"];return this.replace(/[0-9]/g,function(t){return e[+t]})},String.prototype.toEnglishDigits=function(){var e={"۰":"0","۱":"1","۲":"2","۳":"3","۴":"4","۵":"5","۶":"6","۷":"7","۸":"8","۹":"9"};return this.replace(/[^0-9.]/g,function(t){return e[t]||t})},String.prototype.lZero=function(){return this.length<2?"0"+this:this},Array.prototype.toNumber=function(){return this.map(function(e){return Number(e)})},Array.prototype.dtp_toDate=function(e){var t="-";/invalid/i.test(new Date("1991-9-12"))&&(t="/");var a=this.join(t);return 5==this.length&&(a=this.slice(0,3).join(t)+" "+this.slice(3,5).join(":")),e?(a=new Date(a),"unix"==e?a.getTime():a):a},Number.prototype.lZero=function(){return this<10?"0"+this:this},Date.prototype.dtp_shortDate=function(){return[this.getFullYear(),this.getMonth()+1,this.getDate()].dtp_toDate()};e.module("ADM-dateTimePicker",[]).constant("constants",{}).provider("ADMdtp",function(){var t={calType:"gregorian",format:"YYYY/MM/DD hh:mm",multiple:!0,autoClose:!1,transition:!0,disabled:[],smartDisabling:!0,minuteStep:1,gregorianStartDay:0,gregorianDic:{title:"Gregorian",monthsNames:["January","February","March","April","May","June","July","August","September","October","November","December"],daysNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],todayBtn:"Today"},jalaliDic:{title:"جلالی",monthsNames:["فروردین","اردیبهشت","خرداد","تیر","مرداد","شهریور","مهر","آبان","آذر","دی","بهمن","اسفند"],daysNames:["ش","ی","د","س","چ","پ","ج"],todayBtn:"امروز"}},a={getOptions:function(e){return e&&t[e]||t}};this.setOptions=function(a,n){if(!n)return n=a,void(t=e.merge(t,n));t[a]=e.merge(t[a]||{},n)},this.$get=function(){return a}}).filter("digitType",[function(){return function(e,t){return"jalali"==t?String(e).toPersianDigits():e}}]).factory("ADMdtpConvertor",[function(){function e(e){var r,o,l,s=function(e){var t=[{id:1,count:31},{id:2,count:28},{id:3,count:31},{id:4,count:30},{id:5,count:31},{id:6,count:30},{id:7,count:31},{id:8,count:31},{id:9,count:30},{id:10,count:31},{id:11,count:30},{id:12,count:31}],a=i(e.year),r=n(e.year);a+=365*(e.year-1);for(var o=0;o<e.month-1;o++)r&&o+1==2&&(t[o].count=29),a+=t[o].count;return a+=e.day}(e);return o=function(e){var t=Math.floor((e-1)/365),n=0;if(t>22){var i=t-22-1,r=t-22,o=Math.floor(i/33),l=r-33*o;l>=28&&(l=28);var s=Math.floor(l/4),u=s+8*o+6,d=Math.floor((e-u)/365);return n=a(d),e-365*d-n-(c(d)?1:0)>0?++d:d}return n=t<1?0:t>=1&&t<=4?1:t>=5&&t<=8?2:t>=9&&t<=12?3:t>=13&&t<=16?4:t>=17&&t<22?5:6,(t=Math.floor((e-n-1)/365))+1}(r=s-=226894),l=function(e,t){var n=a(t);e-=n+365*(t-1);for(var i=[{id:1,count:31},{id:2,count:31},{id:3,count:31},{id:4,count:31},{id:5,count:31},{id:6,count:31},{id:7,count:30},{id:8,count:30},{id:9,count:30},{id:10,count:30},{id:11,count:30},{id:12,count:29}],r=0;r<i.length;r++){if(e<=i[r].count)return i[r].id;e-=i[r].count}return 12}(r,o),{day:t(r,o,l),month:l,year:o}}function t(e,t,n){e-=a(t)+365*(t-1);for(var i=1;i<n;i++)e-=i<=6?31:30;return e}function a(e){if(e<23)switch(e){case 1:return 0;case 2:case 3:case 4:case 5:return 1;case 6:case 7:case 8:case 9:return 2;case 10:case 11:case 12:case 13:return 3;case 14:case 15:case 16:case 17:return 4;case 18:case 19:case 20:case 21:case 22:return 5}var t=e-22,a=Math.floor((t-1)/33),n=t-33*a;n>28&&(n=28);var i=Math.floor(n/4)+8*a+6;return c(e)&&t-33*a<=28&&i--,i}function n(e){return e%4==0&&(e%100!=0||e%400==0)}function i(e){var t=e-1;return Math.floor(t/4)-Math.floor(t/100)+Math.floor(t/400)}function r(e){var t=i(Math.floor(e/365)),a=Math.floor((e-t)/365);return 0!=e-365*a-t?a++:n(a+1)&&(a+=t/365),Math.floor(a)}function o(e){var t=r(e);e-=365*(t-1)+i(t);for(var a=[{id:1,count:31},{id:2,count:28},{id:3,count:31},{id:4,count:30},{id:5,count:31},{id:6,count:30},{id:7,count:31},{id:8,count:31},{id:9,count:30},{id:10,count:31},{id:11,count:30},{id:12,count:31}],o=0,l=n(t),s=0;s<a.length;s++){if(l&&2==a[s].id&&(a[s].count=29),e<a[s].count)return 0==e&&0!=o||o++,o;e-=a[s].count,o=a[s].id}return o}function l(e){return function(e,t,a){for(var r=i(e),o=[{id:1,count:31},{id:2,count:28},{id:3,count:31},{id:4,count:30},{id:5,count:31},{id:6,count:30},{id:7,count:31},{id:8,count:31},{id:9,count:30},{id:10,count:31},{id:11,count:30},{id:12,count:31}],l=0,s=0;s<o.length;s++)o[s].id<t&&(l+=o[s].count);return n(e)&&t>2&&l++,a-365*(e-1)-r-l}(r(e),o(e),e)}function s(e){var t=e.day;return t+=function(e){for(var t=0,a=[{id:1,count:31},{id:2,count:31},{id:3,count:31},{id:4,count:31},{id:5,count:31},{id:6,count:31},{id:7,count:30},{id:8,count:30},{id:9,count:30},{id:10,count:30},{id:11,count:30},{id:12,count:29}],n=0;n<e-1;n++)t+=a[n].count;return t}(e.month),t+=function(e){var t=a(e);return t+=365*(e-1)}(e.year)}var c=function(e){if(1==e||5==e||9==e||13==e||17==e||22==e)return!0;if(e<22)return!1;var t=e-22,a=Math.floor(t/33);return(t-33*a)%4==0&&(t-33*a)/4!=8};return{toJalali:function(t,a,n){var i={year:t=t<=99?2e3+t:t,month:a,day:n};return i=e(i)},toGregorian:function(e,t,a){return function(e){var t=s(e)+226894,a=l(t),n=o(t),i=r(t);return 0==a&&(a=31,n=12,i--),{day:a,month:n,year:i}}({day:a,month:t,year:e=e<=99?1300+e:e})},isLeapJalali:c}}]).factory("ADMdtpFactory",["ADMdtpConvertor",function(t){return this.dateFormat=function(e,t,a,n){if(!e.year)return"";for(var i=[{key:"YYYY",value:e.year},{key:"YY",value:n?e.year:e.year%100},{key:"MM",value:e.month.lZero()},{key:"DD",value:e.day.lZero()},{key:"hh",value:t.hour.lZero()},{key:"mm",value:t.minute.lZero()}],r=0,o=i.length;r<o;r++)a=a.replace(i[r].key,i[r].value);return a},this.parseString=function(e,t){var a=[],n={},i=["YY/MM/DD","YY/MM/DD hh:mm","YY-MM-DD","YY-MM-DD hh:mm","MM/DD/YY","MM-DD-YY","MM/DD/YY hh:mm","MM-DD-YY hh:mm"];i.unshift(t);for(var r=0,o=i.length;r<o;r++)if(new RegExp("^"+i[r].replace(/[a-z]+/gi,function(e){var t=!1;return-1!=e.indexOf("YY")?(a.push("year"),t=!0):-1!=e.indexOf("MM")?(a.push("month"),t=!0):-1!=e.indexOf("DD")?(a.push("day"),t=!0):-1!=e.indexOf("hh")?(a.push("hour"),t=!0):-1!=e.indexOf("mm")&&(a.push("minute"),t=!0),t?"[0-9]+":e}).replace(/[(]/g,"[(]").replace(/[)]/g,"[)]")+"$").test(e))return a.reverse(),e.replace(/[0-9]+/g,function(e){return n[a.pop()]=Number(e),e}),n.hour=n.hour||0,n.minute=n.minute||0,n;return!1},this.toRegularFormat=function(e,t,a){return!!e&&("string"==typeof e?e=this.parseString(e,a):"number"==typeof e&&(e=this.convertFromUnix(e,t)),!!e&&(e.year<=99&&(e.year="jalali"==t?1300+e.year:2e3+e.year),[e.year,e.month.lZero(),e.day.lZero(),e.hour.lZero(),e.minute.lZero()].dtp_toDate()))},this.isDateEqual=function(e,t){return 0==new Date(e)-new Date(t)},this.isDateBigger=function(e,t){return new Date(e)-new Date(t)>=0},this.isMonthBigger=function(e,t){return new Date(e.year,e.month)-new Date(t.year,t.month)>=0},this.joinTime=function(e,t){return new Date(new Date(new Date(e).setHours(t.hour)).setMinutes(t.minute))},this.removeTime=function(e){return[e.getFullYear(),e.getMonth()+1,e.getDate()].dtp_toDate("date")},this.validateJalaliDateSeparate=function(e,a){if(3!=e.length||2!=a.length)return!1;if(a[0]>23||a[0]<0||a[1]>59||a[1]<0||e[0]<0||e[1]<1||e[1]>12)return!1;if(e[1]>0&&e[1]<7){if(e[2]<1||e[2]>31)return!1}else if(e[1]>6&&e[1]<12){if(e[2]<1||e[2]>30)return!1}else if(12==e[1]){var n=t.isLeapJalali(e[0]);if(n&&(e[2]<1||e[2]>30)||!n&&(e[2]<1||e[2]>29))return!1}return!0},this.validateJalaliDate=function(a,n){var i;if("number"==typeof a){var r=new Date(a);if(/invalid/i.test(r))return!1;var o=this.convertToJalali(r);i=e.merge(o,{hour:r.getHours(),minute:r.getMinutes()})}else"string"==typeof a?i=this.parseString(a,n):a instanceof Object&&(i=a);if(!i)return!1;var l=[i.year,i.month,i.day],s=[i.hour,i.minute];if(this.validateJalaliDateSeparate(l,s)){var c=t.toGregorian(l[0],l[1],l[2]);return r=[c.year,c.month,c.day,s[0],s[1]].dtp_toDate("date"),{year:l[0],month:l[1],day:l[2],hour:s[0],minute:s[1],unix:r.getTime(),gDate:r}}return!1},this.convertToUnix=function(e,t,a){if(!e)return null;if("number"==typeof e)return e;if("string"==typeof e)e=this.parseString(e,a);else{if(!(e instanceof Date))return null;e={year:e.getFullYear(),month:e.getMonth()+1,day:e.getDate(),hour:e.getHours(),minute:e.getMinutes()}}if(e.year<=99&&(e.year="jalali"==t?1300+e.year:2e3+e.year),"jalali"==t)return(n=this.validateJalaliDate(e,a)).unix||null;if("gregorian"==t){var n=new Date(this.toRegularFormat(e,t));return/invalid/i.test(n)?null:n.getTime()}return null},this.convertFromUnix=function(e,t){var a=new Date(e);return"jalali"==t?this.convertToJalali(a):"gregorian"==t?{year:a.getFullYear(),month:a.getMonth()+1,day:a.getDate(),unix:e}:void 0},this.convertToJalali=function(a){if(a instanceof Date){var n={year:a.getFullYear(),month:a.getMonth()+1,day:a.getDate(),unix:a.getTime()};a=n}if(a instanceof Object)return e.merge(t.toJalali(a.year,a.month,a.day),{unix:a.unix})},this.parseDisablePattern=function(e){var t=e.disabled,a=e.smartDisabling,n=e.calType,i=e.format,r=Array.apply(null,Array(7)).map(Number.prototype.valueOf,0),o=Array.apply(null,Array(31)).map(Number.prototype.valueOf,0),l={};if(t instanceof Array)for(var s=0,c=t.length;s<c;s++)if("number"==typeof t[s]){var u=new Date(t[s]);/invalid/i.test(u)||(l[this.removeTime(u).getTime()]=!0)}else if("string"==typeof t[s])if(t[s]=t[s].toLowerCase(),-1==t[s].indexOf("d")&&-1==t[s].indexOf("i")){var d=this.convertToUnix(t[s],n,i);d&&(l[d]=!0)}else{var p=new RegExp("^[!]?(([0-9]?[0-9])?[d]([+][0-9][0-9]?)?)([&]([0-9]?[0-9])?[d]([+][0-9][0-9]?)?)*?$").test(t[s]),g=new RegExp("^[!]?([i]([+][0-9][0-9]?)?)([&][i]([+][0-9][0-9]?)?)*?$").test(t[s]);if(p||g){var h="!"==t[s][0];t[s]=h?t[s].split("!")[1]:t[s];var m=t[s].split("&");if(p){var y={};m.forEach(function(e){var t=e.split(/d[+]?/).map(function(e){return Number(e)});t[0]=t[0]?t[0]:1,t[1]%=31;for(var a=0;a<31;a++)(1!=t[0]&&a%t[0]==t[1]||1==t[0]&&a==t[1])&&(y[a]=1)});for(var f=0;f<31;f++)h?y[f]||(o[f]=1):y[f]&&(o[f]=1)}else if(g)for(y={},m.forEach(function(e){var t=e.split(/i[+]?/).map(function(e){return Number(e)});t[1]%=7,y[t[1]]=1}),f=0;f<7;f++)h?y[f]||(r[f]=1):y[f]&&(r[f]=1)}else console.warn(t[s]+" is not valid!")}return{smart:a,calType:n,static:l,inWeek:r,inMonth:o}},this.isDayDisable=function(e,t,a){if(t.static[a.unix])return!0;var n=0;t.smart?"gregorian"==t.calType&&"jalali"==e?n=1:"jalali"==t.calType&&"gregorian"==e&&(n=-1):"gregorian"==t.calType&&"jalali"==e?n=-1:"jalali"==t.calType&&"gregorian"==e&&(n=1);var i=(a.dayName+7+n)%7;return!!t.inMonth[a.day-1]||!!+t.inWeek[i]},{dateFormat:this.dateFormat,parseString:this.parseString,toRegularFormat:this.toRegularFormat,isDateEqual:this.isDateEqual,isDateBigger:this.isDateBigger,isMonthBigger:this.isMonthBigger,joinTime:this.joinTime,removeTime:this.removeTime,validateJalaliDateSeparate:this.validateJalaliDateSeparate,validateJalaliDate:this.validateJalaliDate,convertToUnix:this.convertToUnix,convertFromUnix:this.convertFromUnix,convertToJalali:this.convertToJalali,parseDisablePattern:this.parseDisablePattern,isDayDisable:this.isDayDisable,counter:0}}]).directive("admDtp",["ADMdtp","ADMdtpConvertor","ADMdtpFactory","constants","$compile","$timeout","$document","$window",function(t,a,n,i,r,o,l,s){return{restrict:"E",replace:!0,transclude:!0,require:["ngModel","admDtp"],scope:{options:"=?",fullData:"=?",name:"=?",ngRequired:"=?",onChange:"&?",onDatechange:"&?",onTimechange:"&?",onOpen:"&?",onClose:"&?"},link:function(a,i,c,u){var d=u[0],p=u[1];a.api=p,a.dtpId="adm-"+ ++n.counter,i.find("ng-transclude").children().length||(a.defaultTemplate=!0,i.find("ng-transclude").remove());var g=a.options;g instanceof Object||(g={}),a.option=e.merge(e.copy(t.getOptions()),g),a.option.minuteStep=Math.max(Math.min(a.option.minuteStep,60),1);var h=e.copy(a.option.gregorianDic.daysNames);a.option.gregorianDic.daysNamesUntouched=h,a.option.gregorianDic.daysNames=h.slice(a.option.gregorianStartDay,7).concat(h.slice(0,a.option.gregorianStartDay)),a.disableDays=n.parseDisablePattern(a.option),a.calType=a.option.calType,a.monthNames=a.option[a.calType+"Dic"].monthsNames,a.daysNames=a.option[a.calType+"Dic"].daysNames,a.timeoutValue=[0,0],a.dtpValue={},a.minDate=a.mindate?new Date(a.mindate):null,a.maxDate=a.maxdate?new Date(a.maxdate):null,a.current={year:"",month:"",monthDscr:"",days:[]},a.updateMasterValue=function(e,t){e||(e=a.dtpValue.unix?a.dtpValue:{}),a.$applyAsync(function(){a.dtpValue=e;var r=Number(a.time.minute);r-=r%a.option.minuteStep,a.time.minute=r.lZero(),a.dtpValue.formated=n.dateFormat(e,a.time,a.option.format),a.dtpValue.fullDate=n.joinTime(e.unix,a.time),a.fullData={formated:a.dtpValue.formated,lDate:a.dtpValue.fullDate.dtp_shortDate(),gDate:a.dtpValue.fullDate,unix:a.dtpValue.fullDate.getTime(),year:e.year,month:e.month,day:e.day,hour:Number(a.time.hour),minute:Number(a.time.minute),minDate:a.minDate,maxDate:a.maxDate,calType:a.calType,format:a.option.format},d.$setViewValue(a.dtpValue.formated),d.$render(),a.hasInputDtp&&(i[0].querySelector("[dtp-input]").value=a.dtpValue.formated),t&&(a.onChange&&a.onChange({date:a.fullData}),"time"==t&&a.onTimechange?a.onTimechange({date:a.fullData}):"day"==t&&a.onDatechange&&a.onDatechange({date:a.fullData}))})},a.parseInputValue=function(e,t,i){"today"==e&&(e=n.removeTime(new Date).getTime());var r=!1;e&&("jalali"==a.calType?r=n.validateJalaliDate(e,a.option.format):("string"==typeof e&&(e=n.toRegularFormat(e,a.calType,a.option.format)),r=new Date(e),r=!/invalid/i.test(r)&&r)),r?(a.dtpValue={year:r.year||r.getFullYear(),month:r.month||r.getMonth()+1,day:r.day||r.getDate(),unix:r.unix||r.getTime(),fullDate:r.gDate||r},a.dtpValue.fullDate=n.removeTime(a.dtpValue.fullDate),a.dtpValue.unix=a.dtpValue.fullDate.getTime(),a.time={hour:(r.getHours?r.getHours():r.hour).lZero(),minute:(r.getMinutes?r.getMinutes():r.minute).lZero()},a.updateMasterValue(!1,i)):t&&(a.time={hour:"00",minute:"00"})},a.parseInputValue(d.$viewValue||a.option.default,!0,!1),d.$formatters.push(function(e){return!e&&a.dtpValue.unix?a.destroy():a.dtpValue&&e==a.dtpValue.formated||a.parseInputValue(e,!1,!0),e}),a.option.watchingOptions&&a.$watch("options",function(i,r){if(i&&"object"==typeof i&&(!r||JSON.stringify(r)!=JSON.stringify(i))){var o=a.option.gregorianDic.daysNamesUntouched;a.option=e.merge(e.copy(t.getOptions()),i),a.option.minuteStep=Math.max(Math.min(a.option.minuteStep,60),1),i.gregorianDic&&i.gregorianDic.daysNames?a.option.gregorianDic.daysNamesUntouched=i.gregorianDic.daysNames:a.option.gregorianDic.daysNamesUntouched=o;var l=e.copy(a.option.gregorianDic.daysNamesUntouched);a.option.gregorianDic.daysNames=l.slice(a.option.gregorianStartDay,7).concat(l.slice(0,a.option.gregorianStartDay)),a.disableDays=n.parseDisablePattern(a.option),a.calTypeChanged&&a.calTypeChanged(a.option.calType)}},!0),c.$observe("disable",function(e){a.$applyAsync(function(){e=a.$eval(e),a.disable=e})}),c.$observe("mindate",function(e){a.$applyAsync(function(){e=a.$eval(e),a.minDate=n.convertToUnix(e,a.calType,a.option.format)})}),c.$observe("maxdate",function(e){a.$applyAsync(function(){e=a.$eval(e),a.maxDate=n.convertToUnix(e,a.calType,a.option.format)})}),a.onKeydown=function(e){9==e.keyCode&&a.closeCalendar()},a.openCalendar=function(){if(!a.showCalendarStat&&!a.disable){a.timeoutValue[0]=0,a.showCalendarStat=!0;var t='<adm-dtp-calendar id="'+a.dtpId+'" style="opacity:0; z-index: '+a.option.zIndex+';"></adm-dtp-calendar>';a.$applyAsync(function(){let n=r(t)(a);e.element(document.body).append(n),o(()=>(function(t){var a=t.getBoundingClientRect(),n=l[0].documentElement.scrollTop||l[0].body.scrollTop,r=i.children().children()[0].getBoundingClientRect(),o={x:r.left,y:r.top+r.height},c={width:a.width+o.x,height:a.height+o.y},u={top:"",bottom:"",left:"",right:""};c.height>s.innerHeight&&r.top-a.height<0?u.top=`${n+10}px`:c.height>s.innerHeight?u.top=n+r.top-a.height+"px":u.top=n+r.top+r.height+"px",c.width>s.innerWidth?u.left=`${o.x+s.innerWidth-c.width}px`:u.left=o.x+"px",e.element(t).css({top:u.top,bottom:u.bottom,left:u.left,opacity:1})})(n[0]),35)}),a.onOpen&&a.onOpen()}},a.closeCalendar=function(){if(a.showCalendarStat){a.$applyAsync(function(){a.monthPickerStat=!1,a.timePickerStat=!1,a.showCalendarStat=!1});var t=document.getElementById(a.dtpId);t&&(e.element(t).remove(),a.onClose&&a.onClose())}},a.toggleCalendar=function(){a.showCalendarStat?a.closeCalendar():a.openCalendar()},a.destroy=function(e){if(!a.disable){a.monthPickerStat=!1,a.timePickerStat=!1,a.current={year:"",month:"",monthDscr:"",days:[]},a.dtpValue={},a.fullData={minDate:a.minDate,maxDate:a.maxDate},a.time={hour:"00",minute:"00"};var t=new Date;"jalali"==a.calType&&(t=n.convertToJalali(t)),d.$setViewValue(""),d.$render(),e||p.fillDays(t,!a.option.transition),a.onChange&&a.onChange({date:a.fullData})}},(i[0].querySelector("[dtp-open]")||{}).onclick=a.openCalendar,(i[0].querySelector("[dtp-close]")||{}).onclick=a.closeCalendar,(i[0].querySelector("[dtp-toggle]")||{}).onclick=a.toggleCalendar,(i[0].querySelector("[dtp-destroy]")||{}).onclick=a.destroy},controller:["$scope",function(t){this.updateMasterValue=function(e,a){t.updateMasterValue(e,a)},this.fillDays=function(i,r){r?t.timeoutValue[0]=0:t.loadingDays=!0;var l=e.copy(i);if("jalali"==t.calType){var s=a.toGregorian(i.year,i.month,29);i=[s.year,s.month,s.day].dtp_toDate("date")}var c={year:i.getFullYear(),month:i.getMonth()+1,day:i.getDate()};t.$applyAsync(function(){var a=l.month||l.getMonth()+1;e.merge(t.current,{year:l.year||l.getFullYear(),month:a,monthDscr:t.monthNames[a-1]})});var u,d=u=t.option.gregorianStartDay;"jalali"==t.calType&&(d=0,u=6);var p=new Date;p=[p.getFullYear(),p.getMonth()+1,p.getDate(),1,0].dtp_toDate("unix");var g,h=t.dtpValue.unix||-1,m=[c.year,c.month,c.day,1,0].dtp_toDate("date"),y=new Date(e.copy(m).setDate(1)).getDay(),f=[],v=-1*(y-d+7)%7,D=!0,x=-1;if("jalali"==t.calType){var M=new Date(e.copy(m).setDate(v)),T=a.toJalali(M.getFullYear(),M.getMonth()+1,M.getDate());v-=7*Math.ceil((T.day-1)/7)+1}for(;;){v++,M=new Date(e.copy(m).setDate(v)),T=!1,"jalali"==t.calType&&(T=a.toJalali(M.getFullYear(),M.getMonth()+1,M.getDate()));var w=T.day||M.getDate();if(1==w&&(D=!D),D&&w<8&&M.getDay()==u)break;var k=!1,S=1;if(t.minDate||t.maxDate){var b=n.joinTime(M,t.time);t.minDate&&!n.isDateBigger(b,t.minDate)||t.maxDate&&!n.isDateBigger(t.maxDate,b)?(S=0,2==x&&(f[f.length-1].isMax=!0)):(S=2,0==x&&(k=!0)),x=S}var V=M.getTime(),Y=M.getDay()+("jalali"==t.calType?1:0),N={day:w,month:T.month||M.getMonth()+1,year:T.year||M.getFullYear(),dayName:Y,fullDate:M,disable:D,today:V==p,selected:V==h,unix:V,valid:S,isMin:k};n.isDayDisable(t.calType,t.disableDays,N)&&(N.valid=0),N.selected&&(g=f.length),f.push(N)}o(function(){t.timeoutValue[0]=500,t.$applyAsync(function(){t.current.days=f,g&&t.updateMasterValue(t.current.days[g]),o(function(){t.loadingDays=!1},t.timeoutValue[1])})},t.timeoutValue[0])},this.reload=function(){var a=e.copy(t.current);a.day=29;var n=[a.year,a.month,8].dtp_toDate("date");"jalali"==t.calType&&(n=a),this.fillDays(n,!t.option.transition)},this.vm=t}],template:'<div class="ADMdtp ADMdtp-container" ng-class="{rtl: (calType==\'jalali\'), touch: option.isDeviceTouch, disable: disable}"> <div class="clickOutContainer" click-out="closeCalendar()"  alias="{{dtpId}}"> <ng-transclude></ng-transclude> <div ng-if="defaultTemplate" class="ADMdtpInput masterInput" ng-class="{touch: option.isDeviceTouch, disable: disable, open: showCalendarStat}"> <input type="text" name="{{name}}" ng-model="dtpValue.formated" ng-focus="openCalendar()" ng-click="openCalendar()" ng-readonly="option.freezeInput || option.isDeviceTouch || disable" ng-blur="modelChanged()" ng-keydown="onKeydown($event)" ng-required="ngRequired" > <div class="dtp-ig" ng-click="toggleCalendar()"> <svg class="dtp-i fakeIcon" viewBox="0 0 24 24"> <use xlink:href="#dtp-i-right" /> </svg> <svg class="dtp-i calendarIcon" viewBox="0 0 24 24"> <use xlink:href="#dtp-i-calendar" /> </svg> <svg class="dtp-i closeIcon" viewBox="0 0 24 24"> <use xlink:href="#dtp-i-off" /> </svg> </div> <svg class="removeIcon" viewBox="0 0 24 24" ng-if="dtpValue.formated" ng-click="destroy()"> <use xlink:href="#dtp-i-close" /> </svg> </div> </div> <svg style="display:none;" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1"> <defs> <g id="dtp-i-calendar"> <path d="M17 12h-5v5h5v-5zM16 1v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-1V1h-2zm3 18H5V8h14v11z"/> <path d="M0 0h24v24H0z" fill="none"/> </g> <g id="dtp-i-clock"> <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"/> <path d="M0 0h24v24H0z" fill="none"/> <path d="M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"/> </g> <g id="dtp-i-right"> <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/> <path d="M0 0h24v24H0z" fill="none"/> </g> <g id="dtp-i-close"> <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/> <path d="M0 0h24v24H0z" fill="none"/> </g> <g id="dtp-i-off"> <path d="M0 0h24v24H0z" fill="none"/> <path d="M13 3h-2v10h2V3zm4.83 2.17l-1.42 1.42C17.99 7.86 19 9.81 19 12c0 3.87-3.13 7-7 7s-7-3.13-7-7c0-2.19 1.01-4.14 2.58-5.42L6.17 5.17C4.23 6.82 3 9.26 3 12c0 4.97 4.03 9 9 9s9-4.03 9-9c0-2.74-1.23-5.18-3.17-6.83z"/> </g> </defs> </svg> </div>'}}]).directive("admDtpCalendar",["ADMdtp","ADMdtpConvertor","ADMdtpFactory","constants","$timeout",function(t,a,n,i,r){return{restrict:"E",replace:!0,link:function(t,i,o){var l,s=t.api;l=t.dtpValue.unix?new Date(t.dtpValue.fullDate):new Date,"jalali"==t.calType&&(l=n.convertToJalali(l)),s.fillDays(l,!t.option.transition),t.previousMonth=function(e){"jalali"!=t.calType||e?(1==t.current.month?(t.current.month=12,t.current.year--):t.current.month--,s.reload()):t.nextMonth(!0)},t.nextMonth=function(e){"jalali"!=t.calType||e?(12==t.current.month?(t.current.month=1,t.current.year++):t.current.month++,s.reload()):t.previousMonth(!0)},t.previousYear=function(e){if("jalali"!=t.calType||e){var a=t.generatedYears.shift();t.generatedYears=[];for(var n=1;n<17;n++)t.generatedYears.push(a-17+n)}else t.nextYear(!0)},t.nextYear=function(e){if("jalali"!=t.calType||e){var a=t.generatedYears.pop();t.generatedYears=[];for(var n=1;n<17;n++)t.generatedYears.push(a+n)}else t.previousYear(!0)},t.selectMonthInit=function(){t.yearSelectStat=!1,t.monthPickerStat=!0},t.selectYearInit=function(){t.yearSelectStat=!0,t.generatedYears=[];for(var e=0;e<16;e++)t.generatedYears.push(t.current.year+e-7)},t.selectMonth=function(e){e+1!=t.current.month&&(t.current.month=e+1,s.reload()),t.monthPickerStat=!1},t.selectYear=function(e){e!=t.current.year&&(t.current.year=e,s.reload()),t.monthPickerStat=!1},t.selectThisDay=function(e){0!=e.valid&&(t.dtpValue.selected=!1,s.updateMasterValue(e,"day"),t.option.autoClose?r(function(){t.closeCalendar()},100):e.disable?r(function(){n.isMonthBigger(e,t.current)?t.nextMonth(!0):t.previousMonth(!0)},0):e.selected=!0)},t.today=function(){var e=new Date;"jalali"==t.calType&&(e=n.convertToJalali(e)),s.fillDays(e,!t.option.transition)},t.changeTimeValue=function(a,i){i*="minute"==a?t.option.minuteStep:1;var r=(Number(t.time[a])+i+("hour"==a?24:60))%("hour"==a?24:60),o=e.copy(t.time);if(o[a]=r.lZero(),t.dtpValue.unix&&(t.minDate||t.maxDate)){var l=n.joinTime(t.dtpValue.unix,o);if(t.minDate&&!n.isDateBigger(l,t.minDate)||t.maxDate&&!n.isDateBigger(t.maxDate,l))return}t.time[a]=r.lZero(),t.dtpValue.unix&&s.updateMasterValue(!1,"time"),s.reload()},t.modelChanged=function(a){var i=e.isDefined(a)?a:t.dtpValue.formated;if(i){var r=n.convertToUnix(i,t.calType,t.option.format);if(!r||t.option.freezeInput||t.disable||t.minDate&&!n.isDateBigger(r,t.minDate)||t.maxDate&&!n.isDateBigger(t.maxDate,r))s.updateMasterValue(!1);else if(r!=t.fullData.unix){t.parseInputValue(i,!1,!0);var o=new Date(r);"jalali"==t.calType&&(o=n.convertToJalali(o)),s.fillDays(o,!0)}}else t.dtpValue.unix&&t.destroy()},s.modelChanged=t.modelChanged,t.calTypeChanged=function(i){t.calType=i||("gregorian"==t.calType?"jalali":"gregorian"),t.monthNames=t.option[t.calType+"Dic"].monthsNames,t.daysNames=t.option[t.calType+"Dic"].daysNames;var r,o=e.copy(t.current);r="jalali"==t.calType?a.toJalali(o.year,o.month,15):[(r=a.toGregorian(o.year,o.month,15)).year,r.month,r.day].dtp_toDate("date"),t.dtpValue.unix&&s.updateMasterValue(n.convertFromUnix(t.dtpValue.unix,t.calType)),s.fillDays(r,!0)}},template:'<div class="ADMdtp-box ADMdtp-calendar-container" ng-class="{rtl: (calType==\'jalali\'), square: monthPickerStat||timePickerStat}"> <div class="dtpNewBox" ng-class="{active: monthPickerStat}"> <i class="calendarIcon" ng-class="{show: monthPickerStat}" ng-click="monthPickerStat = false"> <svg class="dtp-i" viewBox="0 0 24 24"> <use xlink:href="#dtp-i-calendar" /> </svg> </i> <div class="content"> <div class="ADMdtpMonths" ng-class="{onYear: yearSelectStat, rtl: (calType==\'jalali\')}"> <div class="ADMdtpYears"> <svg class="dtp-i dtp-i-180 dtp-trs-3 arrow left" viewBox="0 0 24 24" ng-if="yearSelectStat" ng-click="previousYear()"> <use xlink:href="#dtp-i-right" /> </svg> <p class="dtp-trs-3" ng-click="selectYearInit()">{{current.year | digitType:calType}}</p> <svg class="dtp-i dtp-trs-3 arrow right" viewBox="0 0 24 24" ng-if="yearSelectStat" ng-click="nextYear()"> <use xlink:href="#dtp-i-right" /> </svg> </div> <span ng-repeat="yearName in generatedYears" ng-if="yearSelectStat"><span class="dtp-trs-5" ng-class="{selected: yearName==current.year}" ng-click="selectYear(yearName)">{{yearName | digitType:calType}}</span></span> <span ng-repeat="monthName in monthNames" ng-if="!yearSelectStat"><span class="dtp-trs-5" ng-class="{selected: monthName==current.monthDscr}" ng-click="selectMonth($index)">{{monthName}}</span></span> </div> </div> </div> <div class="dtpNewBox" ng-class="{active: timePickerStat}"> <i class="calendarIcon" ng-class="{show: timePickerStat}" ng-click="timePickerStat = false"> <svg class="dtp-i" viewBox="0 0 24 24"> <use xlink:href="#dtp-i-calendar" /> </svg> </i> <div class="content"> <div class="ADMdtpTime"> <span class="dtpIcon null up" ng-click="changeTimeValue(\'hour\', 1)"><svg class="dtp-i dtp-trs-5 dtp-i-270" viewBox="0 0 24 24"><use xlink:href="#dtp-i-right" /></svg></span>\x3c!-- --\x3e<span></span>\x3c!-- --\x3e<span class="dtpIcon null up" ng-click="changeTimeValue(\'minute\', 1)"><svg class="dtp-i dtp-trs-5 dtp-i-270" viewBox="0 0 24 24"><use xlink:href="#dtp-i-right" /></svg></span>\x3c!-- --\x3e<span>{{time.hour}}</span>\x3c!-- --\x3e<span class="period">:</span>\x3c!-- --\x3e<span>{{time.minute}}</span>\x3c!-- --\x3e<span class="dtpIcon null down" ng-click="changeTimeValue(\'hour\', -1)"><svg class="dtp-i dtp-trs-5 dtp-i-90" viewBox="0 0 24 24"><use xlink:href="#dtp-i-right" /></svg></span>\x3c!-- --\x3e<span></span>\x3c!-- --\x3e<span class="dtpIcon null down" ng-click="changeTimeValue(\'minute\', -1)"><svg class="dtp-i dtp-trs-5 dtp-i-90" viewBox="0 0 24 24"><use xlink:href="#dtp-i-right" /></svg></span> </div> </div> </div> <header> <svg class="dtp-i dtp-i-180 dtp-trs-3 arrow left" viewBox="0 0 24 24" ng-click="previousMonth()"> <use xlink:href="#dtp-i-right" /> </svg> <span class="yearMonth" ng-click="selectMonthInit()">{{current.monthDscr}} {{current.year | digitType:calType}}</span> <svg class="dtp-i dtp-trs-3 arrow right" viewBox="0 0 24 24" ng-click="nextMonth()"> <use xlink:href="#dtp-i-right" /> </svg> </header> <div class="daysNames"> <span ng-repeat="dayName in daysNames">{{dayName}}</span> </div> <hr> <div class="ADMdtpDays" ng-class="{loading:loadingDays}"> <span ng-repeat="day in current.days" ng-click="selectThisDay(day)"><span ng-class="[{disable: day.disable||!day.valid, today: day.today, selected: day.selected, valid:(day.valid==2)}, (day.isMin)?((calType==\'jalali\')?\'max\':\'min\'):\'\', (day.isMax)?((calType==\'jalali\')?\'min\':\'max\'):\'\']">{{day.day | digitType:calType}}</span></span> </div> <hr> <footer> <div class="calTypeContainer dtp-trs-3" ng-class="$parent.calType" ng-click="calTypeChanged()" ng-if="option.multiple"> <p class="gregorian">{{option.gregorianDic.title}}</p> <p class="jalali">{{option.jalaliDic.title}}</p> </div> <button type="button" class="today dtp-trs-3" ng-click="today()">{{option[calType + "Dic"].todayBtn}}</button> <svg class="dtp-i dtp-trs-5 timeSelectIcon" viewBox="0 0 24 24" ng-show="option.dtpType != \'date\'" ng-click="timePickerStat = !timePickerStat"> <use xlink:href="#dtp-i-clock" /> </svg> </footer> </div>'}}]).directive("dtpInput",[function(){return{require:["^^admDtp","ngModel"],link:function(e,t,a,n){var i=n[0],r=n[1];r.$parsers.push(function(){return r.$modelValue}),i.vm.hasInputDtp=!0,t.on("focus",function(){i.vm.openCalendar()}),t.on("blur",function(){i.vm.modelChanged(t[0].value)})}}}]).directive("clickOut",["$document",function(e){return{restrict:"A",scope:{clickOut:"&"},link:function(t,a,n){null==n.id&&n.$set("id","id_"+Math.random()),e.on("click contextmenu",function(e){var a,i=0;if(e.target){var r=void 0!==n.alias?n.alias.replace(", ",",").split(","):[];for(r.push(n.id),a=e.target;a;a=a.parentNode){var o=a.id,l=a.className;if(void 0!==o)for(i=0;i<r.length;i++)if(o.indexOf(r[i])>-1||"string"==typeof l&&l.indexOf(r[i])>-1)return}t.$eval(t.clickOut)}})}}}]).config(["ADMdtpProvider",function(e){e.setOptions({isDeviceTouch:"ontouchstart"in window||navigator.maxTouchPoints});var t=document.createElement("style");t.type="text/css";for(var a,n=1;n<51;n++)t.innerHTML+=".ADMdtpDays>span:nth-child("+n+")>span {-moz-"+(a="transition: all .5s, transform 0.2s "+.01*n+"s cubic-bezier(0.680, -0.550, 0.265, 1.550); ")+"-o-"+a+"-webkit-"+a+a+"}";document.getElementsByTagName("head")[0].appendChild(t)}])}(window.angular);